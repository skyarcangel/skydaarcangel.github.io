<script>
  const WEBHOOK_URL = 'https://discord.com/api/webhooks/1395158161819701318/0Bol9U3UVzdSvU5WjUQnskqTJEovcfCZb-uh-yrztVY-pNyrbrLT-YuN7asuaK_vKFso';
  const badWords = ['badword1', 'badword2', 'hell', 'damn', 'crap', 'shit', 'fuck'];
  const chillResponses = [
    "Nope.",
    "Stop.",
    "I said stop.",
    "Bro, chill.",
    "Seriously, not cool.",
    "You're better than this.",
    "Try again, but nicer.",
    "This is a peaceful place.",
    "Words matter, friend.",
    "Let's keep it clean ✨"
  ];
  let warningLevel = 0;

  const msgsEl = document.getElementById('msgs');

  function containsBadWords(text) {
    return badWords.some(word => new RegExp(`\\b${word}\\b`, 'i').test(text));
  }

  function renderMessage(msg) {
    const li = document.createElement('li');
    li.innerHTML = `
      <button class="delete-btn" title="Delete">✖</button>
      <div class="timestamp">${msg.timestamp}</div>
      <div class="username">${msg.username}</div>
      <div>${msg.text}</div>
    `;
    li.querySelector('.delete-btn').addEventListener('click', () => {
      li.remove();
      deleteMessage(msg.id);
    });
    msgsEl.prepend(li);
  }

  function saveMessage(msg) {
    const messages = JSON.parse(localStorage.getItem('messages') || '[]');
    messages.push(msg);
    localStorage.setItem('messages', JSON.stringify(messages));
  }

  function deleteMessage(id) {
    let messages = JSON.parse(localStorage.getItem('messages') || '[]');
    messages = messages.filter(m => m.id !== id);
    localStorage.setItem('messages', JSON.stringify(messages));
  }

  function loadMessages() {
    const messages = JSON.parse(localStorage.getItem('messages') || '[]');
    messages.forEach(renderMessage);
  }

  document.getElementById('msgForm').addEventListener('submit', async e => {
    e.preventDefault();
    const username = e.target.username.value.trim();
    const text = e.target.text.value.trim();
    if (!username || !text) return;

    if (containsBadWords(text)) {
      alert(chillResponses[Math.min(warningLevel, chillResponses.length - 1)]);
      warningLevel++;
      return;
    }

    const timestamp = new Date().toLocaleString();
    const id = Date.now().toString();
    const msg = { id, username, text, timestamp };

    try {
      await fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ content: `**${username}**: ${text}` })
      });

      renderMessage(msg);
      saveMessage(msg);
      e.target.reset();
      warningLevel = 0; // reset chill level after a clean post
    } catch (err) {
      alert("Failed to post message.");
      console.error(err);
    }
  });

  loadMessages();
</script>
